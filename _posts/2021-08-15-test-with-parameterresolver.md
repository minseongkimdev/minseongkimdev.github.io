---
title: "ParameterResolver를 통한 테스트 코드 리팩토링"
layout: post
category: Testing
---

## 0. 글의 순서

- [0. 글의 순서](#0-글의-순서)
- [1. 고민의 시작](#1-고민의-시작)
- [1. Static 오브젝트를 모아놓은 유틸 클래스로 분리하기](#1-static-오브젝트를-모아놓은-유틸-클래스로-분리하기)
- [2. Mock 오브젝트 생성을 상속을 통해 분리](#2-mock-오브젝트-생성을-상속을-통해-분리)
- [3. ParameterResolver](#3-parameterresolver)
- [글을 마치며](#글을-마치며)
- [참고 서적](#참고-서적)
- [출처](#출처)

## 1. 고민의 시작

> 여러 테스트 클래스에서 반복되는 Mock 오브젝트의 생성을 리팩토링할 순 없을까?

결론 부터 말하면 최종적으로 ParameterResolver 방식을 택하게 되었고, 다른 방식 대신 이 방식까지 도달하게 된 사고의 흐름을 공유해보고자 한다.



## 1. Static 오브젝트를 모아놓은 유틸 클래스로 분리하기

Mock 객체를 Static으로 선언해서 이를 보관하는 유틸 클래스로 분리해내면 되지 않을까? 라는 아이디어이다.

구현이 비교적 단순하고 직관적인 장점이 있지만

이 방식의 문제점은 한 테스트 메서드에서 해당 스태틱 Mock 객체를 수정하게 되면, 이 객체를 사용하는 모든 메서드에 상태가 반영된다.

테스트는 기본적으로 독립적으로 이루어져야 하고, 스태틱 Mock 객체의 상태가 변경되어 다른 테스트 메서드의 통과/실패 여부에 영향을 주면 안된다.

이런 테스트의 원칙을 어길 잠재적인 문제점이 있을 수 있기 때문에 비록 지금 프로젝트가 구현단계이고 테스트 코드가 적을 때는 문제가 없을수도 있지만, 프로젝트가 커지고 테스트 코드가 많아졌을 때 문제가 생길수 있다.

## 2. Mock 오브젝트 생성을 상속을 통해 분리

공통적으로 Mock 오브젝트를 생성하기 위한 부모 클래스로 두고

해당 Mock 오브젝트가 필요한 클래스는 이 클래스를 상속받는 자식클래스로 두는 방식이다.

하지만 상속의 특성에 대해 알아보자.

is-a관계가 만족하는가?

상속을 통해 Mock 오브젝트를 위한 부모클래스를 뒀을 때 이런 문제가 있을 수 있다.




## 3. ParameterResolver

JUnit에서는 ParameterResolver 라는 기능을 제공한다.

상속으로부터 자유롭고, 해당 오브젝트가 공유됨으로써 발생하는 문제에 대해 걱정할 필요는 없다.

(공식문서 찾아보면서 동작원리, 스펙 찾아보기)



## 글을 마치며

애플리케이션을 구동하는 코드의 리팩토링도 중요하지만 이를 검증하는 테스트

테스트 코드의 작성은 지금 당장의 비용이 들 수 있겠지만, 나중에 발생하는 더 큰 비용을 막아주는데 도움을 준다.

(대충 왜 테스트 코드가 중요하고 테스트 코드의 리팩토링도 중요한지)

(더 나은 방법이 있다면 댓글로 피드백 부탁드립니다.)


## 참고 서적

* 자바와 JUnit을 활용한 실용주의 단위 테스트

##  출처

- [junit5 ParameterResolver](http://wonwoo.ml/index.php/post/1878)